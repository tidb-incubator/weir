# 配置热加载

Weir作为多租户的TiDB数据库治理平台, 租户配置变更是一项比较频繁的操作. 如果每次增加, 修改, 删除租户配置都需要重新启动Weir Proxy才能使配置生效, 无疑会对用户体验和服务稳定性带来很大影响. 因此, 我们为Weir的Namespace配置提供了热加载支持. (注: 热加载要求配置中心使用etcd)

Weir支持通过管理接口触发配置热加载, 过程包括准备 (Prepare) 和提交 (Commit) 两个阶段. 在准备阶段, Weir Proxy会从配置中心拉取Namespace的最新配置, 解析配置并初始化Namespace. 在提交阶段, Weir Proxy会执行一次原子切换操作, 使用新的Namespace处理客户端的请求, 同时将旧的Namespace延迟关闭.

整个热加载过程, Weir Proxy不会主动关闭客户端连接, 客户端是无感知的, 对于一些非核心配置的调整, 甚至不需要重建后端数据库连接池, 对提升客户端体验和保持Weir本身以及后端TiDB集群稳定性都有比较大的帮助.
